# Task 1. Демонстрация работы GC [#202257]

Объект User (64 разрядная система) | Размер
--- | :---:
Пустой объект User без полей | 12 байт
String "firstName": Vasya  | 48 байт
String "secondName": Pupkin | 48 байт
Ссылка "firstName" | 4 байта
Ссылка "secondName" | 4 байта
Выравнивание для кратности 8 | 4 байта
**Итого по объекту User:** | **120 байт**

### Расшифровка класса User
Класс String содержит следующие нестатические поля (**начиная с JDK 9**):<br>

	private final byte[] value;
	private final byte coder;
	private int hash;
	
Подсчитываем размер объекта String:

	new String()
	Заголовок: 12 байт
	Поле byte coder: 1 байт
	Поле int hash: 4 байта
	Ссылочная переменная на объект массива value: 4 байта
	3 байта выравнивания
	Итого: 24 байта
	
В классе String само слово (Vasya) храниться в массиве. Подсчитываем размер:

	new byte[5]
	Заголовок: 12 байт + 4 байта на длину массива = 16 байт
	Примитивы byte: 1 байт * 5 = 5 байт
	Выравнивание для кратности 8: 3 байта
	Итого: 24 байта
	Итого, new String("Vasya") = 48 (24+24) байт
	
Подсчитываем размер массива со словом Pupkin:

	new byte[6]
	Заголовок: 12 байт + 4 байта на длину массива = 16 байт
	Примитивы byte: 1 байт * 6 = 6 байт
	Выравнивание для кратности 8: 2 байта
	Итого: 24 байта
	Итого, new String("Pupkin") = 48 (24+24) байт
	
Приведённые расчёты показывают, что класс User занимает 120 байт.
Проверка данных расчетов:

[Create 4000 Users](https://yadi.sk/i/Q6Muo9Hi_CgIbw)

Для проверки создаём в классе GC 4 тыс. объектов User с ключом -Xmx4m. 
При этом новые строки создаём через конструктор new, чтобы постоянно создавался новый объект,
а не бралась строка из пула.
При таком количестве объектов сборщик мусора не 
запускается. Как видно на скрине до запуска программы имели 1 414 728 свободных байт.
После создания всех 4.000 объектов User имеем свободной памяти 941 488 байт.
Таким образом на создание 4 тыс. юзеров ушло 473 240 байт. Или 118 байт на объект, что примерно 
соответсвует расчётным данным.

Увеличим число объектов до 4100 юзеров. 
На приведенном скрине видим, что начинает срабатывать сборщик мусора.

[Create 4100 Users](https://yadi.sk/i/W6OU-cTqLxsH6w)



	
